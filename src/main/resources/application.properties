# ==============================================================================
# APPLICATION METADATA
# ==============================================================================
# The unique identifier for this microservice. Used by Service Discovery (Eureka), 
# Tracing (as service.name), and Log Aggregators.
spring.application.name=iam-service

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================
# The port on which the Tomcat/Netty server will listen.
server.port=8080

# Includes the 'message' field in JSON error responses. 
# WARNING: Set to 'never' or 'on_param' in Production to avoid leaking stack trace details 
# or internal logic to potential attackers.
spring.web.error.include-message=always

# ==============================================================================
# OBSERVABILITY (OpenTelemetry & Actuator)
# ==============================================================================

# --- Logging Levels ---
# Root/Spring framework logs kept at INFO to reduce noise.
logging.level.org.springframework=INFO
# Application-specific logs set to DEBUG for granular visibility during development.
logging.level.pl.jakubsiekiera.iam=DEBUG

# --- Actuator Endpoints ---
# Exposes vital monitoring endpoints over HTTP. 
# /health: Readiness/Liveness checks for K8s/Docker.
# /prometheus: Scraped by Prometheus to collect application metrics.
management.endpoints.web.exposure.include=health,info,metrics,prometheus

# --- 1. TRACING (Spans) -> Uses gRPC (Port 4317) ---
# OTLP (OpenTelemetry Protocol) endpoint for traces (e.g., Jaeger or Tempo).
management.otlp.tracing.endpoint=http://localhost:4317
# gRPC is preferred for tracing as it is more efficient for high-frequency binary data.
management.otlp.tracing.transport=grpc
# 1.0 = 100% of requests. In high-traffic environments, use 0.01 (1%) or 0.1 (10%) 
# to save on storage and performance overhead.
management.tracing.sampling.probability=1.0

# --- 2. METRICS (Stats) -> Uses HTTP (Port 4318) ---
# OTLP endpoint for metrics (e.g., Prometheus or Grafana Mimir).
management.otlp.metrics.export.url=http://localhost:4318/v1/metrics
# How often metrics are pushed to the collector. 10s is standard for high-res monitoring.
management.otlp.metrics.export.step=10s

# ==============================================================================
# DOCKER COMPOSE SUPPORT
# ==============================================================================
# Enables Spring Boot 3.1+ feature to automatically discover services in docker-compose.yml.
spring.docker.compose.enabled=true
# Forces the app to bridge its datasource settings to a specific Docker service named 'postgres'.
spring.docker.compose.service.connection.name=postgres

# ==============================================================================
# DATABASE CONNECTION
# ==============================================================================
# Primary database connection string. 'iam_db' should exist in the Postgres instance.
spring.datasource.url=jdbc:postgresql://localhost:5432/iam_db
spring.datasource.username=user
spring.datasource.password=password
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP: Setting this to 0 prevents the application from crashing if the DB isn't 
# ready immediately upon startup (helpful for slow-starting Docker containers).
spring.datasource.hikari.initialization-fail-timeout=0

# ==============================================================================
# JPA / HIBERNATE
# ==============================================================================
# 'validate': Checks if the Java @Entity classes match the existing DB schema.
# Does NOT change the database. Best practice for Production when using Flyway.
spring.jpa.hibernate.ddl-auto=validate

# Prints SQL statements to the console. Disable in production to avoid log bloat.
spring.jpa.show-sql=true
# Pretty-prints the SQL output for better readability in terminal.
spring.jpa.properties.hibernate.format_sql=true

# Prevents Hibernate from trying to validate the schema against constraints 
# before Flyway has had a chance to run its migrations.
spring.jpa.properties.hibernate.validator.apply_to_ddl=false

# ==============================================================================
# MIGRATION (Flyway)
# ==============================================================================
# Automatically runs scripts in src/main/resources/db/migration on startup.
spring.flyway.enabled=true
# repair-on-migrate=true: Useful if a migration failed and you've manually 
# fixed the DB; it cleans up the schema_history table.
# spring.flyway.repair-on-migrate=true

# ==============================================================================
# SECURITY (OAuth2 Resource Server)
# ==============================================================================
# The URI of the Identity Provider. Spring Security will fetch public keys 
# from this URL to verify the signature of incoming JWT tokens.
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8081/realms/saas-iam

# ==============================================================================
# KEYCLOAK ADMIN CLIENT (Custom Config)
# ==============================================================================
# Custom properties used by the application's service layer to authenticate 
# with Keycloak to perform admin tasks (like creating users or resetting passwords).
keycloak.auth-server-url=http://localhost:8081
keycloak.realm=saas-iam
keycloak.admin.username=admin
keycloak.admin.password=admin

# Enables Spring Boot's 'Debug' mode. Provides a report on "Condition Evaluation" 
# to show why certain beans were or weren't created.
debug=true